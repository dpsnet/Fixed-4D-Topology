# 数学公式修复方案
**日期**: 2026-02-13  
**目标**: 避免 ln(ℓ/ℓ_0) 奇点

---

## 🚨 当前公式的问题

### 原公式
```
d_s(ℓ) = d_max - c1 / ln(ℓ/ℓ_0)
```

### 奇点问题
当 ℓ = ℓ_0 时：
```
ln(ℓ_0/ℓ_0) = ln(1) = 0
d_s = d_max - c1/0 → 无穷大
```

**物理上不合理！**

---

## 🔧 修复方案

### 方案1: Logistic型过渡 (推荐)

**公式**:
```
d_s(ℓ) = d_min + (d_max - d_min) / (1 + (ℓ_0/ℓ)^(1/c1))
```

**优点**:
- 无数学奇点
- 平滑过渡
- 参数物理意义清晰

**验证**:
- ℓ → 0: d_s → d_min (正确)
- ℓ → ∞: d_s → d_max (正确)
- ℓ = ℓ_0: d_s = (d_min + d_max)/2 (中点)

### 方案2: 双曲正切过渡

**公式**:
```
d_s(ℓ) = d_min + (d_max - d_min) * (1 + tanh(ln(ℓ/ℓ_0)/c1)) / 2
```

**优点**:
- 无数学奇点
- 对称过渡

**缺点**:
- 仍有ln，但放在tanh内，整体平滑

### 方案3: 幂律型

**公式**:
```
d_s(ℓ) = d_max - (d_max - d_min) * (ℓ_0/(ℓ_0 + ℓ))^(1/c1)
```

**优点**:
- 简单
- 无对数

---

## ✅ 选择: 方案1 (Logistic型)

### 原因
1. **无对数**，避免所有奇点问题
2. **物理直观**: S型过渡符合维度流预期
3. **可逆性**: 可以从数据反推c1

### 新公式参数关系

给定新公式:
```
d_s(ℓ) = d_min + (d_max - d_min) / (1 + (ℓ_0/ℓ)^(1/c1))
```

在 ℓ = ℓ_0 处:
```
d_s(ℓ_0) = d_min + (d_max - d_min) / 2 = (d_min + d_max)/2
```

这与原公式不同！原公式在ℓ=ℓ_0处发散，新公式在中点。

**这是可以接受的**，因为我们之前对"特征尺度ℓ_0"的定义就是近似的。

---

## 📝 实现计划

1. 实现新公式
2. 重新设计分形生成器
3. 重新设计c1提取器
4. 验证结果

---

**下一步**: 实现新公式
