# AI并行执行框架

## 核心原则

### 1. 任务驱动而非时间驱动
- 人类：按天/周分配固定时间
- AI：按任务依赖关系和优先级动态调度

### 2. 真正并行执行
- 三个方向可同时推进
- 计算任务可并行运行
- 文献阅读与计算可重叠

### 3. 动态资源分配
- 根据任务复杂度自动分配计算资源
- 根据进展随时调整优先级
- 实时重规划

### 4. 自动化质量检查
- 每完成一个任务自动验证
- 自动生成进展报告
- 自动识别阻塞点

---

## 任务系统架构

### 任务数据结构
```yaml
task:
  id: "K-001"                    # 唯一标识
  direction: "kleinian"          # 所属方向
  type: "read" | "compute" | "prove" | "write"
  priority: 1-10                 # 动态优先级
  status: "pending" | "active" | "blocked" | "completed"
  
  # 依赖关系
  dependencies: ["K-001", "M-003"]  # 前置任务
  blocks: ["K-005"]                 # 阻塞的任务
  
  # 内容
  title: "阅读Beardon第1-2章"
  deliverables:                    # 可验证产出
    - "notes/beardon_ch1-2.md"
    - "概念清单: 离散群, 基本域, 极限集"
  
  # 质量检查点
  checkpoints:
    - "能解释什么是Fuchsian群"
    - "能画出基本域示意图"
    
  # 元数据
  estimated_effort: "2h"           # 预估工作量
  actual_effort: "1.5h"            # 实际耗时
  created: "2026-01-15T10:00:00Z"
  completed: "2026-01-15T11:30:00Z"
```

### 任务状态机
```
pending → active → [blocked] → completed
   ↑                            ↓
   └────────────────────────────┘ (重新激活)
```

---

## 并行执行策略

### 三层并行

```
┌─────────────────────────────────────────┐
│  L1: 方向级并行                         │
│  Kleinian || p-adic || Maass           │
│  三个方向同时推进                       │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│  L2: 任务类型并行                       │
│  文献阅读 || 计算实验 || 理论推导       │
│  不同类型任务可重叠                     │
└─────────────────────────────────────────┘
                   ↓
┌─────────────────────────────────────────┐
│  L3: 计算并行                           │
│  多核/多线程/分布式计算                 │
│  数值实验批量运行                       │
└─────────────────────────────────────────┘
```

### 执行模式

#### 模式A: 深度优先 (攻坚)
- 集中资源突破单一方向
- 适用：某方向接近临界点
- 资源分配：80% | 10% | 10%

#### 模式B: 广度优先 (探索)
- 三个方向均衡推进
- 适用：初期探索阶段
- 资源分配：40% | 35% | 25%

#### 模式C: 响应式 (自适应)
- 根据实时进展动态调整
- 自动识别瓶颈并重新分配
- 默认模式

---

## 动态优先级算法

### 优先级计算因素

```python
def calculate_priority(task):
    score = 0
    
    # 1. 方向战略权重 (0-40分)
    direction_weights = {
        "kleinian": 40,      # 最高潜力
        "padic": 35,
        "maass": 25
    }
    score += direction_weights[task.direction]
    
    # 2. 阻塞影响 (0-30分)
    blocked_tasks = count_blocked_tasks(task)
    score += min(30, blocked_tasks * 10)
    
    # 3. 时效性 (0-20分)
    if task.is_milestone:
        days_to_deadline = task.deadline - now
        score += max(0, 20 - days_to_deadline)
    
    # 4. 准备度 (0-10分)
    if all(dep.completed for dep in task.dependencies):
        score += 10
    
    return score
```

### 实时重排序
- 每完成一个任务，重新计算所有pending任务的优先级
- 每分钟检查是否有更高优先级任务需要抢占
- 长任务可分解为子任务以便穿插执行

---

## 依赖关系图

### 全局任务图
```
[K-001: 双曲几何基础]
    ↓
[K-002: 离散群理论] ─────┐
    ↓                     │
[K-003: 极限集概念]      │
    ↓                     │
[K-004: 计算工具安装] ────┼──→ [K-010: 首次计算实验]
    ↓                     │
[P-001: p-adic数基础]    │
    ↓                    │
[P-002: p-adic分析]     │
    ↓                    │
[M-001: 自守形式基础] ────┘
```

### 跨方向依赖
- 某些概念在多个方向共享（如L-函数）
- 一个方向的发现可能解锁其他方向
- 共享任务自动合并避免重复

---

## 自动化工作流

### 工作循环 (每分钟)
```
1. 检查完成的任务 → 更新依赖状态
2. 计算所有pending任务的新优先级  
3. 选择top-N个任务进入active状态
4. 分配资源并开始执行
5. 检查阻塞任务是否有解
6. 生成状态快照
```

### 质量门控
```
任务完成时自动检查:
├── 产出文件是否存在？
├── 关键概念是否记录？
├── 是否有未解决问题？
├── 是否需要外部验证？
└── 是否触发新的依赖任务？
```

### 异常处理
```
检测到以下情况时自动响应:
├── 任务超时 (>2x预估) → 分解或寻求帮助
├── 依赖循环 → 标记并警告
├── 资源争用 → 动态调度
├── 方向停滞 (>7天无进展) → 提升优先级或放弃
└── 发现重大联系 → 创建跨方向任务
```

---

## 执行状态仪表板

### 实时显示
```
┌─────────────────────────────────────────────────┐
│ AI研究执行仪表板                    [实时更新]  │
├─────────────────────────────────────────────────┤
│                                                 │
│ 方向进展:                                       │
│ Kleinian    [████████████████░░░░░░░░] 62%     │
│ p-adic      [████████████░░░░░░░░░░░░] 42%     │
│ Maass       [████████░░░░░░░░░░░░░░░░] 28%     │
│                                                 │
│ 活动任务 (3):                                   │
│ 🔵 K-015 计算极限集维数 [运行中] 15min         │
│ 🟢 P-008 阅读Coleman论文 [进行中] 45min        │
│ 🟡 M-006 理解Hejhal算法 [暂停] 等待K-012      │
│                                                 │
│ 队列 (12):                                      │
│ 1. K-016 验证Bowen公式适用性 [优先级: 92]      │
│ 2. P-009 p-adic Julia集实验 [优先级: 87]       │
│ 3. K-017 阅读McMullen论文 [优先级: 85]         │
│ ...                                             │
│                                                 │
│ 阻塞 (2):                                       │
│ ⚠️  P-005 等待Gouvêa教材获取                    │
│ ⚠️  M-012 需要理解热力学形式                    │
│                                                 │
│ 最近完成:                                       │
│ ✅ K-014 安装SnapPy (2min ago)                 │
│ ✅ P-007 p-adic绝对值练习 (15min ago)          │
│                                                 │
└─────────────────────────────────────────────────┘
```

### 关键指标
- **速度**: 任务完成速率 (任务/小时)
- **效率**: 实际时间/预估时间
- **并行度**: 同时活跃任务数
- **阻塞率**: 被阻塞任务占比
- **质量分**: 产出通过检查点的比例

---

## 自适应重新规划

### 触发重新规划的事件
1. 完成重要里程碑
2. 发现新的依赖关系
3. 任务失败或超时
4. 外部输入（新文献、新思路）
5. 方向可行性评估变化

### 重新规划流程
```
检测到事件
    ↓
评估当前计划有效性
    ↓
识别需要调整的部分
    ↓
生成替代方案
    ↓
评估各方案预期收益
    ↓
选择最优方案
    ↓
更新任务图和优先级
    ↓
继续执行
```

---

## 与人类协作接口

### 人类输入类型
1. **战略调整**: 改变方向权重
2. **资源注入**: 提供新文献/工具/数据
3. **质量审核**: 审查关键产出
4. **问题解答**: 回答AI无法解决的问题
5. **方向终止**: 决定放弃某个方向

### AI输出
1. **定期报告**: 进展、问题、建议
2. **即时通知**: 重大发现或阻塞
3. **决策请求**: 需要人类判断的事项
4. **资源需求**: 需要获取的文献/工具

---

## 实施文件

### 任务数据库
- 位置: `tasks/active_tasks.yaml`
- 格式: YAML，便于版本控制
- 包含所有任务的完整状态

### 执行日志
- 位置: `logs/execution_YYYY-MM-DD.log`
- 记录所有执行事件
- 用于分析和优化

### 状态快照
- 位置: `snapshots/snapshot_YYYYMMDD_HHMMSS.json`
- 每分钟保存完整状态
- 支持回滚和复盘

---

## 启动指令

### 初始化
```bash
# 1. 加载任务数据库
load_tasks("tasks/initial_tasks.yaml")

# 2. 验证依赖图无循环
validate_dependency_graph()

# 3. 计算初始优先级
calculate_all_priorities()

# 4. 启动主循环
start_execution_loop()
```

### 运行模式
- **全速模式**: 最大化并行，快速推进
- **平衡模式**: 保持各方向进展均衡
- **聚焦模式**: 集中资源于单一方向
- **探索模式**: 广度优先，快速扫盲

---

## 性能优化

### 缓存策略
- 文献内容索引，快速检索
- 计算结果缓存，避免重复
- 依赖预计算，快速调度

### 批处理
- 相似任务批量执行
- 计算实验批量提交
- 文献下载/处理批量进行

### 预加载
- 预测下一步需要的资源
- 提前获取相关文献
- 预热计算环境

---

**框架版本**: 1.0-AI
**适用对象**: AI Agent
**执行模式**: 全自动/半自动/手动
