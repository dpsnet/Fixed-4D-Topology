# AI执行手册

## 快速开始

### 1. 查看当前状态
```bash
cd docs/research
python execution_controller.py --dashboard
```

### 2. 获取执行建议
```bash
python execution_controller.py --report
```

### 3. 启动执行循环 (可选)
```bash
python execution_controller.py --run
```

---

## 执行模式

### 模式A: AI自主执行 (推荐)
AI根据任务优先级自动选择和执行任务

**优点**:
- 最大化并行效率
- 自动处理依赖关系
- 实时调整优先级

**使用场景**: 文献获取、阅读笔记、计算实验

### 模式B: 人类指导执行
人类指定下一步任务，AI执行

**使用场景**:
- 需要判断的研究决策
- 外部资源获取失败时
- 质量问题需要人工审核

### 模式C: 混合模式 (默认)
AI自主执行 + 关键节点人工确认

---

## 任务执行流程

```
┌─────────────────────────────────────────────┐
│ 1. 检查就绪任务                              │
│    - 依赖是否完成？                          │
│    - 资源是否可用？                          │
└──────────────────┬──────────────────────────┘
                   ↓
┌─────────────────────────────────────────────┐
│ 2. 计算优先级                                │
│    - 方向战略权重                            │
│    - 阻塞影响                                │
│    - 里程碑加权                              │
└──────────────────┬──────────────────────────┘
                   ↓
┌─────────────────────────────────────────────┐
│ 3. 选择Top-N任务                            │
│    - 默认N=3 (可配置)                        │
│    - 考虑资源限制                            │
└──────────────────┬──────────────────────────┘
                   ↓
┌─────────────────────────────────────────────┐
│ 4. 并行执行                                  │
│    - 文献阅读 (并行)                         │
│    - 计算实验 (并行)                         │
│    - 笔记整理 (并行)                         │
└──────────────────┬──────────────────────────┘
                   ↓
┌─────────────────────────────────────────────┐
│ 5. 完成检查                                  │
│    - 产出文件存在？                          │
│    - 检查点通过？                            │
│    - 质量达标？                              │
└──────────────────┬──────────────────────────┘
                   ↓
┌─────────────────────────────────────────────┐
│ 6. 更新状态                                  │
│    - 标记完成                                │
│    - 更新依赖                                │
│    - 重新计算优先级                          │
└─────────────────────────────────────────────┘
```

---

## 任务类型处理

### 文献获取 (acquire)
**动作**: 搜索并下载PDF
**成功标准**: 文件可访问，目录可提取
**失败处理**: 标记为阻塞，请求人工获取

### 阅读 (read)
**动作**: 阅读并提取关键概念
**产出**: 
- `notes/[作者]_[章节].md`
- 概念清单
- 问题清单
**成功标准**: 检查点全部通过
**并行**: 可同时阅读多本文献的不同章节

### 计算 (compute)
**动作**: 运行计算实验
**产出**:
- 代码文件
- 结果数据
- 可视化图像
- 计算报告
**成功标准**: 代码运行无误，结果合理
**并行**: 多个实验可同时运行

### 证明/推导 (prove)
**动作**: 数学推导
**产出**:
- 推导文档
- 证明草稿
**成功标准**: 逻辑严密，可验证
**注意**: 可能需要人工审核

### 综合 (synthesize)
**动作**: 跨方向概念整合
**产出**:
- 共享概念文档
- 类比映射
**成功标准**: 多个方向的共识

---

## 优先级动态调整

### 自动提升优先级的情况
1. **阻塞大量后续任务** (+20分)
2. **里程碑任务逾期** (+15分)
3. **方向战略价值提升** (+0-40分)
4. **新发现的重要联系** (+10分)

### 自动降低优先级的情况
1. **依赖长期未完成** (-10分)
2. **方向可行性下降** (-20分)
3. **重复任务** (-30分，建议合并)

---

## 阻塞处理

### 常见阻塞原因

| 原因 | 自动处理 | 需人工介入 |
|------|----------|------------|
| 文献无法下载 | 尝试替代源 | 购买/借阅 |
| 计算资源不足 | 排队等待 | 申请更多资源 |
| 前置任务失败 | 标记失败 | 分析原因 |
| 概念不理解 | 标记问题 | 寻求帮助 |
| 工具安装失败 | 重试3次 | 手动安装 |

### 阻塞升级策略
```
阻塞时间    行动
─────────────────────────
< 1小时     自动重试/等待
1-24小时    尝试替代方案
> 24小时    人工通知
> 7天       标记方向风险
```

---

## YAML实时更新机制

### 核心特性
**所有任务状态变更会立即保存到YAML文件**

```
执行流程:
1. 获取就绪任务
   ↓
2. 开始任务 → 状态变为"active" → **立即保存YAML**
   ↓
3. 执行任务
   ↓
4. 完成任务 → 状态变为"completed" → **立即保存YAML**
   ↓
5. 数据持久化（即使程序崩溃，状态不丢失）
```

### 验证方法
```bash
# 查看任务状态是否已保存到YAML
grep -A 5 "id: K-001" tasks/initial_tasks.yaml

# 应该看到类似输出:
#   status: completed
#   completed: 2026-02-11T16:39:44
#   actual_effort: 10min
```

### 自动保存触发点
- ✅ 任务开始 (`start_task`)
- ✅ 任务完成 (`complete_task`)
- ✅ 任务失败 (`fail_task`)
- ✅ 任务阻塞 (`block_task`)
- ✅ 每个执行周期 (`run_cycle`)

---

## 质量门控

### 阅读任务检查点
- [ ] 能用自己的话解释核心概念
- [ ] 能回答章节后的问题
- [ ] 能与其他文献建立联系
- [ ] 记录了不理解的问题

### 计算任务检查点
- [ ] 代码运行无错误
- [ ] 结果与已知数据一致
- [ ] 可视化清晰可理解
- [ ] 误差/限制已记录

### 证明任务检查点
- [ ] 每一步都有依据
- [ ] 边界情况已考虑
- [ ] 与已知定理一致
- [ ] 可能的推广已思考

---

## 资源分配算法

### 默认分配
```
Kleinian:  40%  ████████░░
p-adic:    35%  ███████░░░
Maass:     25%  █████░░░░░
```

### 动态调整触发条件
1. **某方向重大突破** → 临时提升20%
2. **某方向停滞1周** → 降低10%
3. **发现跨方向联系** → 创建共享任务
4. **临近截止日期** → 聚焦关键任务

---

## 执行日志

### 日志位置
- `logs/execution_YYYY-MM-DD.log` - 每日执行日志
- `snapshots/snapshot_YYYYMMDD_HHMMSS.json` - 状态快照
- `logs/report.md` - 自动生成的报告

### 日志内容
```
[2026-01-15T10:00:01Z] 执行控制器启动
[2026-01-15T10:00:02Z] 开始任务: K-001 - 获取Beardon教材
[2026-01-15T10:05:23Z] 完成任务: K-001
[2026-01-15T10:05:24Z] 开始任务: P-001 - 获取Gouvêa教材
[2026-01-15T10:06:15Z] 任务阻塞: P-001 - 等待人工获取
```

---

## 人工介入点

### 建议人工介入的情况
1. **战略决策**: 是否继续某方向
2. **质量审核**: 关键推导的验证
3. **资源申请**: 获取付费文献/软件
4. **方向关联**: 确认发现的联系是否真实
5. **问题解答**: AI无法自行解决的数学问题

### 介入方式
```bash
# 标记任务需要人工审核
python execution_controller.py --review TASK_ID

# 调整方向优先级
python execution_controller.py --weight kleinian 50

# 强制开始某任务
python execution_controller.py --start TASK_ID
```

---

## 性能优化

### 自动优化策略
1. **相似任务批处理**: 同时获取多本文献
2. **预加载**: 提前获取预测需要的资源
3. **缓存**: 避免重复计算
4. **并行I/O**: 下载与计算重叠

### 手动优化
```bash
# 调整最大并行度
export MAX_PARALLEL=10

# 启用全速模式
python execution_controller.py --run --mode full_speed

# 聚焦模式 (单一方向)
python execution_controller.py --run --mode focused --direction kleinian
```

---

## 故障排除

### 问题: 任务长期不推进
**诊断**: `python execution_controller.py --dashboard`
**可能原因**:
- 循环依赖 → 检查任务图
- 资源耗尽 → 清理或申请更多资源
- 全部阻塞 → 人工介入

### 问题: 优先级不合理
**解决**: 调整方向权重或单个任务优先级
```yaml
# 在initial_tasks.yaml中修改
global:
  direction_weights:
    kleinian: 50  # 提升
    padic: 30     # 降低
    maass: 20
```

### 问题: 产出质量低
**解决**: 加强检查点
```yaml
checkpoints:
  - "能解释X给非专业人士"
  - "能回答5个测试问题"
  - "发现了至少1个联系"
```

---

## 高级功能

### 1. 任务分解
自动将大任务分解为子任务
```
K-007 阅读McMullen论文 (6h)
  → K-007a 阅读第1-2节 (2h)
  → K-007b 阅读第3-4节 (2h)
  → K-007c 整理笔记 (2h)
```

### 2. 依赖推荐
根据已读文献推荐下一步阅读
```
已完成: Beardon第1-2章
推荐: 直接阅读Ratcliffe第1-2章 (重叠内容可快速浏览)
```

### 3. 概念关联
自动识别跨文献的相同概念
```
发现: Beardon的"极限集" = Indra's Pearls的"极限集"
建议: 重用已有笔记
```

---

## 总结

### 核心优势
- ⚡ **真正并行**: 不受人类时间限制
- 🎯 **动态调度**: 实时响应进展
- 📊 **透明追踪**: 完整执行记录
- 🔄 **自适应**: 自动调整策略

### 关键区别 (人类 vs AI)
| 方面 | 人类 | AI |
|------|------|-----|
| 并行度 | 1-2任务 | 5+任务 |
| 调度粒度 | 天/周 | 分钟 |
| 调整速度 | 慢 | 实时 |
| 记忆 | 有限 | 完整日志 |
| 创意 | 强 | 中等 |

### 最佳实践
1. **让AI自主运行大部分时间**
2. **定期查看仪表板了解进展**
3. **只在关键节点人工介入**
4. **利用AI的并行能力加速探索**

---

**版本**: 1.0-AI
**适用**: AI Agent执行
**更新**: 动态
